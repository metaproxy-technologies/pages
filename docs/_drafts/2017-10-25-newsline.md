---
title: "Adafruit LED matrixãƒ©ã‚¸ã‚ªä½“æ“"
date: 2017-10-25 02:55:36
---


ç§‹æœˆé›»å­ã§å£²ã£ã¦ã„ã‚‹ãã‚Œã„ãªLEDãƒãƒˆãƒªã‚¯ã‚¹ã§ã„ã‚ã„ã‚ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¡¨ç¤ºã—ã¤ã¤ã€æ¯æœãƒ©ã‚¸ã‚ªä½“æ“ã‚’ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã¿ãŸã€‚
ã€€â€»ã€€2017/9æœˆã‹ã‚‰NHKã®ãƒ©ã‚¸ã‚ªé…ä¿¡ãŒHLSã«ãªã£ãŸã®ã§ã€è¨˜äº‹ä¿®æ­£

<img src="https://cdn-shop.adafruit.com/145x109/420-08.jpg" title="Adafruitã‚ˆã‚Šå¼•ç”¨" />

## 1) ç‰©å“ã®æº–å‚™
- Raspié–¢é€£
    - [Raspberry Pi3 Model B](https://www.amazon.co.jp/Raspberry-%E3%83%9C%E3%83%BC%E3%83%89%EF%BC%86%E3%82%B1%E3%83%BC%E3%82%B9%E3%82%BB%E3%83%83%E3%83%88-Element14%E7%89%88-Computing-Lab/dp/B01CSFZ4JG/ref=sr_1_1?ie=UTF8&qid=1501590457&sr=8-1&keywords=raspberry+pi+3)
    - [Raspi ã®é›»æºã‚¢ãƒ€ãƒ—ã‚¿](https://www.amazon.co.jp/Physical-Computing-Lab-TSI-PI036-5V3A-3-0A-Pi3ãƒ•ãƒ«è² è·æ¤œè¨¼æ¸ˆ/dp/B01N8ZIJL8/ref=pd_bxgy_147_img_2?_encoding=UTF8&psc=1&refRID=RM5AP0KJAG5TBTA2QXDQ)
    - [ãƒã‚¤ã‚¯ãƒ­SDã‚«ãƒ¼ãƒ‰(SDã‚«ãƒ¼ãƒ‰ã«ã™ã‚‹ã‚¢ãƒ€ãƒ—ã‚¿ä»˜ã)](https://www.amazon.co.jp/dp/B06XSV23T1/ref=pd_bxgy_147_img_3?_encoding=UTF8&psc=1&refRID=TSTM3QK4WRPQ1N7DPKDA)
    - [SDã‚«ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ€](https://www.amazon.co.jp/Tanscend-%E3%82%B9%E3%83%9E%E3%83%BC%E3%83%88%E3%83%95%E3%82%A9%E3%83%B3-%E3%82%BF%E3%83%96%E3%83%AC%E3%83%83%E3%83%88%E5%AF%BE%E5%BF%9C-Type-C%E6%90%AD%E8%BC%89-TS-RDC8K/dp/B01EGCQ4WU)
    - [USBã‚¹ãƒ”ãƒ¼ã‚«](https://www.amazon.co.jp/gp/product/B007WSJJUA/)


- LED Matrixé–¢é€£
    - [Adafruit LED matrix 16x32](http://akizukidenshi.com/catalog/g/gM-07764/)
    è´”å±“ç›®ã ã¨æ€ã†ãŒã™ã”ãç¶ºéº—ã€‚è¡—ä¸­ã§ã“ã‚Œã«åŒ¹æ•µã™ã‚‹ç¶ºéº—ã•ã®ã‚„ã¤ã‚’æ¢ã—ã¦ã„ã‚‹ãŒã€ãƒ‘ãƒãƒ³ã‚³å±‹ã®åº—é ­ã«ã‚ã‚‹ã‚„ã¤ãã‚‰ã„ã—ã‹è¦‹å½“ãŸã‚‰ãš
    - [ãã‚Œä»¥å¤–é›»æºå‘¨ã‚Šè‰²ã€…ã¯ã€Adafruitã®ã‚µã‚¤ãƒˆå‚ç…§ã€‚ã€‚ã€‚](https://learn.adafruit.com/connecting-a-16x32-rgb-led-matrix-panel-to-a-raspberry-pi/overview)
    LED matrixç”¨ã®é›»æºã‚¢ãƒ€ãƒ—ã‚¿ã¨LED Matrixå´ã®é›»æºç«¯å­ã‚’ã¤ãªãã‚¸ãƒ£ãƒƒãƒ³ãƒ‘ãƒ¯ã‚¤ãƒ¤ã€ã‚¸ãƒ£ãƒƒã‚¯ãªã©è‰²ã€…ã€‚Adafruitã®ã‚µã‚¤ãƒˆã®æƒ…å ±ãŒæ­£ã—ã„ã®ã¯ã‚ãã¾ã§ã‚‚LED Matrixã«é›»æºã‚’ã¤ãªãã¨ã“ã‚ãã‚‰ã„ã¾ã§ã€‚GPIOã®çµç·šä»¥é™ã¯ã“ã“ã«æˆ»ã£ã¦ããŸæ–¹ãŒã‚ˆã„

## 2) Raspberry Piã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
- OSãªã©
    - [ã“ã®æ–¹ã®è¨˜äº‹ãŒã‚ˆãã¾ã¨ã¾ã£ã¦ã„ã¦ã‚ˆã„ã€‚](https://jyn.jp/raspbian-setup/)
    - SDã‚«ãƒ¼ãƒ‰ã«ç„¼ã„ã¦å·®ã—è¾¼ã‚“ã§èµ·å‹•ã™ã‚‹ã ã‘ãªã®ã§ã€è‡ªåˆ†ã§å½“åˆèª¿ã¹ãªãŒã‚‰ã‚„ã£ãŸã¨ã“ã‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§sshdãŒä¸ŠãŒã£ã¦ã„ãªã‹ã£ãŸã®ã§ã ã„ã¶ã‚¤ãƒ©ã‚¤ãƒ©åˆ‡ã‚Šåˆ†ã‘ã«æ™‚é–“ã‚’è¦ã—ãŸã€‚ä¸å¯§ãªæ–¹ã®ãƒã‚¦ãƒã‚¦ã‚’é ‚ãã¾ã—ã‚‡ã†ã€‚


- USBã‚¹ãƒ”ãƒ¼ã‚«ã‚’æœ‰åŠ¹ã«ã—ã¦ã€å†…è”µã®éŸ³å£°å‡ºåŠ›ã‚¸ãƒ£ãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã€‚
    ã€€ä»Šå›LED Matrixåˆ¶å¾¡ã«åˆ©ç”¨ã™ã‚‹Henner Zelleræ°ä½œæˆã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ã€Raspiå†…è‡“ã®éŸ³å£°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã¯å…±å­˜ã§ããªã„ã€‚ã“ã®ãŸã‚ã€USBã‚¹ãƒ”ãƒ¼ã‚«ã‚’ã¤ãªã„ã§å†…è‡“ã®éŸ³å£°å‡ºåŠ›ã‚¸ãƒ£ãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–ã—ã¦ã‚„ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚å®Ÿã¯è‹¥å¹²å¿˜ã‚Œæ°—å‘³ã€‚USBã‚¹ãƒ”ãƒ¼ã‚«ã‚’é³´ã‚‰ã™æ–¹æ³•ã¯ã€ã“ã¡ã‚‰ã®è¨˜äº‹ãŒã‚ˆã•ãã†ã€‚
ã€€ã€€[Raspberry Pi ã§USBã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚’å‹•ã‹ã™](http://takuya-1st.hatenablog.jp/entry/2014/06/15/180632)

    å†…è”µã®éŸ³å£°å‡ºåŠ›ã‚¸ãƒ£ãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹æ–¹æ³•ã¯ã“ã¡ã‚‰ãŒã‚ˆã•ãã†ã€‚
ã€€ã€€[Disable the Built-in Sound Card of Raspberry Pi](http://www.instructables.com/id/Disable-the-Built-in-Sound-Card-of-Raspberry-Pi/)
```shell
sudo vi alsa-blacklist.conf
ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã‚’å…¥åŠ›
blacklist snd_bcm2835
```

## 3) Raspiã¸ã®çµç·šã€ãŠã‚ˆã³ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã®ç¨¼åƒ

- LED Matrix ã¨é›»æºã‚¢ãƒ€ãƒ—ã‚¿ã®æ¥ç¶š
ã€€ã“ã“ãŒæ…£ã‚Œãªãã¦ä¸€ç•ªå„ä»‹ã ã£ãŸã¯ãšã ãŒã‚ã¾ã‚Šè¨˜æ†¶ã«ãªãã€‚ã€‚ã€‚ã¨ã«ã‹ãï¼‹/ãƒ¼é–“é•ãˆãšã«ç¹‹ã’ã°ã‚ˆã„ã€‚ã€‚ã€‚

- LED Matrix ã¨Raspiã®æ¥ç¶š
ã€€Henner Zelleræ°ã®è§£èª¬ã®ã‚ˆã†ã«ã‚„ã‚‹ã€‚ã€ŒğŸ˜„ã€ãƒãƒ¼ã‚¯ã‚’çµç·šã®ã¿ã§ã‚ˆã„ã€‚
ã€€ã€€https://github.com/hzeller/rpi-rgb-led-matrix/blob/master/wiring.md
ã€€ä»–ã®ã‚¢ã‚¤ã‚³ãƒ³ã®çµç·šã¯ã€ã‚‚ã£ã¨LED Matrixã‚’å¤§é‡ã«ä¸¦ã¹ã‚‹ã¨ãã®ãŸã‚ã®ã‚‚ã®ã€‚å‡ºæ¥ã¦ã¿ã‚‹ã¨ã•ã»ã©é›£ã—ããªã„ã®ã ãŒã€ãƒŸã‚¹ãªãraspiã¨LEDå´ã¨çªåˆã™ã‚‹ã®ãŒå„ä»‹ã ã£ãŸ

## 4) Henner Zelleræ°è£½ã®rpi-rgb-led-matrixã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
ã€€Raspiã¸ãƒ­ã‚°ã‚¤ãƒ³ã—ã€ã“ã“ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’ã™ã¹ã¦æŒã£ã¦ãã‚‹
ã€€ã€€https://github.com/hzeller/rpi-rgb-led-matrix

ã€€ãã®å¾Œã€ä»¥ä¸‹ã®æ‰‹é †ã«æº–æ‹ ã—ã¦ã€rpi-rgb-led-matrixã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å°å…¥ã™ã‚‹
ã€€ã€€https://github.com/hzeller/rpi-rgb-led-matrix/blob/master/python/README.md

```shell
cd (æŒã£ã¦ããŸã‚³ãƒ¼ãƒ‰ã‚’å±•é–‹ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)
cd python
sudo apt-get update && sudo apt-get install python2.7-dev python-pillow -y
make build-python
sudo make install-pythonã€€ã€€
```

ã€€å®Ÿã¯Cã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚‚åŒæ¢±ã•ã‚Œã¦ãŠã‚Šã€ãã¡ã‚‰ã®æ–¹ãŒé€Ÿã„ã€ã¨ã„ã†ã‚ˆã†ãªã“ã¨ãŒæ›¸ã„ã¦ã‚ã‚‹ãŒã€ã‚„ã£ã±ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’æ‰‹è»½ã«ã„ã˜ã‚‹ã«ã¯Pythonã®ã‚ˆã†ãªè¨€èªãŒã‚ˆã„ã€‚ã‚µãƒ³ãƒ—ãƒ«ã‚’èµ°ã‚‰ã›ã¦æ¥½ã—ã‚€ã€‚

```shell
cd samples
sudo ./runtext.py --led-rows=16 --led-brightness=20
```

## 5) ã‚³ãƒ¼ãƒ‰ã‚’ä½œã£ã¦å‹•ã‹ã™

- **crawler.py**
ã€€rss or æŸãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’å–å¾—ã—ã¦ãã¦é…ä¸‹ã®ã€Œnewsimgã€ãƒ•ã‚©ãƒ«ãƒ€ã«ç”»åƒã«ã—ã¦ä¿å­˜ã™ã‚‹ã‚‚ã®ã€‚äºˆã‚ç”»åƒã«ã—ã¦ãŠã„ãŸæ–¹ãŒLED matrixã«é£Ÿã‚ã›ã‚„ã™ã„ã€‚ãªãŠã€äºˆã‚é…ä¸‹ã®ã€Œfontã€ãƒ•ã‚©ãƒ«ãƒ€ã«TrueType or OpenTypeã®ãƒ•ã‚©ãƒ³ãƒˆã‚’å…¥ã‚Œã¦ãŠãå¿…è¦ã‚ã‚Šã€‚è‰²ã€…èª¿æ•´ã—ãŸãŒã€ä»¥ä¸‹ãŒå¥½ã¿ï¼š
-- 16pxå‘ã‘ -> [mplus-2c-medium](https://mplus-fonts.osdn.jp/about.html)
-- 8pxå‘ã‘ -> [ç¾å’²ãƒ•ã‚©ãƒ³ãƒˆ](http://www.geocities.jp/littlimi/misaki.htm)

- **feeder.py**
ã€€crawler.pyãŒé›†ã‚ã¦ããŸç”»åƒã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«è¡¨ç¤ºã™ã‚‹ã€‚ç”»åƒãŒãªã‘ã‚Œã°å¾…ã£ã¦ã€è¦‹ã¤ã‹ã£ãŸæ™‚ç‚¹ã§è¡¨ç¤ºã‚’å†é–‹ã™ã‚‹ã€‚

- **nhk.sh**
ã€€livestreamer + mplay2 ã§ã€€NHKç¬¬ä¸€ã‚’èãã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚
ã€€ä¸Šè¨˜ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒapt-getã§å°å…¥æ¸ˆã¿ã§ã‚ã‚Œã°OKã€‚ã“ã‚“ãªé¢¨ã«ã—ã¦ãƒ©ã‚¸ã‚ªç¬¬ä¸€ã‚’å†ç”Ÿã™ã‚‹

```shell
livestreamer hls://nhkradiobkr1-i.akamaihd.net/hls/live/512291/1-r1/1-r1-01.m3u8 best -p mplayer
```

ã€€omxplayerã®ã¿ã§è¡Œã‘ã‚‹ã¨ã„ã†æƒ…å ±ã‚‚ã‚ã‚‹ã®ã ãŒã€omxplayerã¯USBéŸ³å£°ã‚„HDMIéŸ³å£°ã«å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ãƒ€ãƒ¡ã§ã‚ã£ãŸ

- **å‹•ã‹ã—æ–¹**
ã€€ä¸Šè¨˜ã‚’[Blynk](http://blog.livedoor.jp/victory7com/archives/48316461.html)ã®ã‚ˆã†ãªIoTãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‹ã‚‰å©ãã‹ã€cronã§æ™‚é–“ãŒããŸã‚‰å®Ÿè¡Œã™ã‚‹ãªã©ã™ã‚‹ã¨ã€ãƒ©ã‚¸ã‚ªã§ç›®è¦šã¾ã—ãƒ¼ï¼ãƒ‹ãƒ¥ãƒ¼ã‚¹ã‚’è¦‹ãªãŒã‚‰ãƒ©ã‚¸ã‚ªä½“æ“ã€€ãŒã§ãã‚‹ã€‚

ã€€2A + 5VãŒå‡ºã‚‹ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒ†ãƒªï¼’å€‹ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã¨æŒã¡å‡ºã—ã‚‚ã§ãã‚‹ã®ã§ã€å®Ÿã¯æ˜”æ‡ã‹ã—å¤ä¼‘ã¿ãƒ©ã‚¸ã‚ªä½“æ“ãŒã§ãã‚‹ã®ã ãŒã€è¿‘æ‰€ã®å…¬åœ’ã§æ¯å­ã®åŒç´šç”Ÿã®è¦ªå¾¡ã•ã‚“ã«ä¼šã†å‹‡æ°—ã¯ã¾ã ã€æŒã¡åˆã‚ã›ã¦ãŠã‚‰ãšã€‚ã€‚ã€‚ä¸€æ—¦ã¯å®¶ã®ä¸­ã§ã“ã‚“ãªé¢¨ã«å‹•ã‹ã—ã¾ã—ã‚‡ã†ã€‚ã€‚ã€‚

```shell
./crawler.py &
./nhk.sh &
sudo ./feeder.py
```

#### ä»¥ä¸‹ã€ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚

** crawler.py **
```python
#!/usr/bin/env python
# -*- encoding:utf8 -*-
#Copyright (c) 2017 Tomohiko Araki
#Released under the MIT license
#http://opensource.org/licenses/mit-license.php

import datetime
import time
import argparse
import sys
import os
import random
import feedparser
import hashlib
from glob import glob
from PIL import Image
from PIL import ImageFont
from PIL import ImageDraw
import urllib2
from bs4 import BeautifulSoup
#load Logger
from logging import getLogger, StreamHandler, DEBUG
logger = getLogger(__name__)
handler = StreamHandler()
handler.setLevel(DEBUG)
logger.setLevel(DEBUG)
logger.addHandler(handler)
logger.propagate = False

sys.path.append(os.path.abspath(os.path.dirname(__file__) + '/..'))

def isOkToCrawl():
    crawl_interval = 60 #sec.
    crawl_interval_file = "./lastcrawl"
    now = time.time()

    if os.path.isfile(crawl_interval_file):
        if os.stat(crawl_interval_file).st_mtime > now - 60:
            return False
    
    f = open(crawl_interval_file, 'w')
    f.write(str(now) + "\n")
    f.close()
    return True

def getImageFromFile(path):
    image = Image.open(path).convert('RGB')
    return image

def saveImgFromText(text, imgdir, fontsize):
    path = os.path.abspath(os.path.dirname(__file__))
    if fontsize == 8:
        font   = [ImageFont.truetype(path + '/font/misaki_gothic.ttf', fontsize),1]
    else:
        fontsize = 16
        font  = [ImageFont.truetype(path + '/font/mplus-2c-medium.ttf', fontsize),-2]
        #font  = [ImageFont.truetype(path + '/font/Makinas-Scrap-5.otf', fontsize),-2]
        #font  = [ImageFont.truetype(path + '/font/PixelMplus10-Regular.ttf', fontsize),1]

    color  = [(255,0,255),
             (0,255,255),
             (255,255,0),
             (0,255,0),
             (255,255,255)]

    width, ignore = font[0].getsize(text)
    im = Image.new("RGB", (width + 30, fontsize), "black")
    draw = ImageDraw.Draw(im)
    draw.text((0, font[1]), text, random.choice(color), font=font[0])
    imgname = imgdir+"/"+str(fontsize)+str(hashlib.md5(text.encode('utf_8')).hexdigest())+".ppm"
    if not os.path.exists(imgname):
        im.save(imgname)

def removeOldImg(imgdir):
    #remove ppm files more than 1 days before.
    if not(imgdir=="") and not(imgdir=="/")and not(imgdir=="."): 
        now = time.time()
        for f in os.listdir(imgdir):
            if f[-4:] == '.ppm':
                f = os.path.join(imgdir, f)
                if os.stat(f).st_mtime < now - 0.5 * 86400:
                    if os.path.isfile(f):
                        os.remove(f)

def getNewsFromFeed():
    news  = []
    url = ['https://news.yahoo.co.jp/pickup/economy/rss.xml']
    for tg in url:
        fd = feedparser.parse(tg)
        for ent in fd.entries:
            news.append(u"ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€"+unicode(ent.title))
    return news

def getNewsFromNikkei():
    news  = []
    url = ['http://www.nikkei.com/',
            'http://www.nikkei.com/news/category/?at=ALL&bn=1',
            'http://www.nikkei.com/news/category/?bn=21']
    for tg in url:
        html = urllib2.urlopen(tg)
        soup = BeautifulSoup(html, "html.parser")
        tags = soup.find_all("span", class_="cmnc-large")
        for tag in tags:
            news.append(u"ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€"+tag.text)
        tags = soup.find_all("span", class_="cmnc-middle")
        for tag in tags:
            news.append(u"ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€"+tag.text)
        tags = soup.find_all("span", class_="cmnc-small")
        for tag in tags:
            news.append(u"ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€"+tag.text)
        tags = soup.find_all("span", class_="cmnc-xsmall")
        for tag in tags:
            news.append(u"ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€"+tag.text)
        time.sleep(2.0)
        
    return news

parser = argparse.ArgumentParser()
#parser.add_argument("-r", "--led-rows", action="store", help="Display rows. 16 for 16x32, 32 for 32x32. Default: 32", default=16, type=int)

if isOkToCrawl():
    print ("I gonna crawl.")
    
    imgdir = os.path.abspath(os.path.dirname(__file__)) + "/newsimg"
    if not os.path.isdir(imgdir):
        os.mkdir(imgdir)

    #clean up old news
    removeOldImg(imgdir)

    #get from RSS feed
    for text in getNewsFromFeed():
        saveImgFromText(text, imgdir, 8)

    #get from Nikkei
    for text in getNewsFromNikkei():
        saveImgFromText(text, imgdir, 8)

else:
    print ("You need to wait for 1min before next crawl.")
```


** feeder.py **
```python
#!/usr/bin/env python
# -*- encoding:utf8 -*-

# Copyright (C) 2013 Henner Zeller <h.zeller@acm.org> for original work.
# Copyright (C) 2017 Tomohiko Araki <arakitomohiko@gmail.com> for delivertive work.
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation version 2.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://gnu.org/licenses/gpl-2.0.txt>

import time
import argparse
import sys
import os
import random
import feedparser
from PIL import Image
from PIL import ImageFont
from PIL import Image
from PIL import ImageDraw
#load Logger
from logging import getLogger, StreamHandler, DEBUG
logger = getLogger(__name__)
handler = StreamHandler()
handler.setLevel(DEBUG)
logger.setLevel(DEBUG)
logger.addHandler(handler)
logger.propagate = False

sys.path.append(os.path.abspath(os.path.dirname(__file__) + '/..'))
from rgbmatrix import RGBMatrix, RGBMatrixOptions


def run(image, matrix):
    print("Running")
    image.resize((matrix.width, matrix.height), Image.ANTIALIAS)
    double_buffer = matrix.CreateFrameCanvas()
    img_width, img_height = image.size
    # let's scroll
    xpos = 0
    while True:
        xpos += 1
        if (xpos > img_width):
            xpos = 0
            break
            
        double_buffer.SetImage(image, -xpos)
        double_buffer.SetImage(image, -xpos + img_width)
    
        double_buffer = matrix.SwapOnVSync(double_buffer)
        time.sleep(0.04) #===========modifled

def prepareMatrix(parser):
    args    = parser.parse_args()
    options = RGBMatrixOptions()
    if args.led_gpio_mapping != None:
      options.hardware_mapping = args.led_gpio_mapping
    options.rows = args.led_rows
    options.chain_length = args.led_chain
    options.parallel = args.led_parallel
    options.pwm_bits = args.led_pwm_bits
    options.brightness = args.led_brightness
    options.pwm_lsb_nanoseconds = args.led_pwm_lsb_nanoseconds
    if args.led_show_refresh:
      options.show_refresh_rate = 1
    if args.led_slowdown_gpio != None:
        options.gpio_slowdown = args.led_slowdown_gpio
    if args.led_no_hardware_pulse:
      options.disable_hardware_pulsing = True
    return RGBMatrix(options = options)

def getImageFromFile(path):
    image = Image.open(path).convert('RGB')
    return image

parser = argparse.ArgumentParser()
parser.add_argument("-r", "--led-rows", action="store", help="Display rows. 16 for 16x32, 32 for 32x32. Default: 32", default=16, type=int)
parser.add_argument("-c", "--led-chain", action="store", help="Daisy-chained boards. Default: 1.", default=1, type=int)
parser.add_argument("-P", "--led-parallel", action="store", help="For Plus-models or RPi2: parallel chains. 1..3. Default: 1", default=1, type=int)
parser.add_argument("-p", "--led-pwm-bits", action="store", help="Bits used for PWM. Something between 1..11. Default: 11", default=11, type=int)
parser.add_argument("-b", "--led-brightness", action="store", help="Sets brightness level. Default: 100. Range: 1..100", default=10, type=int)
parser.add_argument("-m", "--led-gpio-mapping", help="Hardware Mapping: regular, adafruit-hat, adafruit-hat-pwm" , choices=['regular', 'adafruit-hat', 'adafruit-hat-pwm'], type=str)
parser.add_argument("--led-scan-mode", action="store", help="Progressive or interlaced scan. 0 Progressive, 1 Interlaced (default)", default=1, choices=range(2), type=int)
parser.add_argument("--led-pwm-lsb-nanoseconds", action="store", help="Base time-unit for the on-time in the lowest significant bit in nanoseconds. Default: 130", default=130, type=int)
parser.add_argument("--led-show-refresh", action="store_true", help="Shows the current refresh rate of the LED panel")
parser.add_argument("--led-slowdown-gpio", action="store", help="Slow down writing to GPIO. Range: 1..100. Default: 1", choices=range(3), type=int)
parser.add_argument("--led-no-hardware-pulse", action="store", help="Don't use hardware pin-pulse generation")
parser.add_argument("-i", "--image", help="The image to display", default="./news.ppm")

imgdir = os.path.abspath(os.path.dirname(__file__)) + "/newsimg"
matrix = prepareMatrix(parser)

if not os.path.isdir(imgdir):
    print("Error: no img to display, no such directory.")
    sys.exit(0)
else:
    while True:
        files = os.listdir(imgdir)
        if len(files)==0:
            print("Warning: no img to display, I am going to wait news to come.")
            time.sleep(5.0)
        else:
            frnd = random.sample(files,len(files))
            for f in frnd:
                if f[-4:] == '.ppm':
                    f = os.path.join(imgdir, f)
                    try:
                        if os.path.exists(f):
                            run(getImageFromFile(f), matrix)
                        else:
                            print("Warning: no such file, next please...")
                    except IOError:
                        print("Warning: no such file, next please...")
                    except KeyboardInterrupt:
                        print("Exiting\n")
                        sys.exit(0)
                else:
                    printf("Warning: Please do not include non-ppm files.")
                    sys.exit(0)
```

** nhk.sh **
```shell
#!/bin/sh
#Copyright (c) 2017 Tomohiko Araki
#Released under the MIT license
#http://opensource.org/licenses/mit-license.php
URL="hls://nhkradioakr1-i.akamaihd.net/hls/live/511633/1-r1/1-r1-01.m3u8"
livestreamer --yes-run-as-root $URL best -p mplayer &
```


#### å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã‚µã‚¤ãƒˆ
- [ãƒ©ã‚ºãƒ‘ã‚¤2ã§LEDé›»å…‰æ²ç¤ºæ¿ã‚’ä½œã‚‹](http://www.buildinsider.net/small/raspisinage/01)
- [Raspberry Pi ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§éŸ³ã‚’é³´ã‚‰ã™](http://raspi.ryo.sc/raspi_play_sound/)
- [raspberry pi ã§ radiko](http://qiita.com/toshidev/items/2839ec100c6ee04934b8)
- [Raspberry Pi ã§USBã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚’å‹•ã‹ã™](http://takuya-1st.hatenablog.jp/entry/2014/06/15/180632)
- [Raspberry Piã§radikoã®å†ç”Ÿã€éŒ²éŸ³](http://blog.muchuu.net/post/110867859055/raspberry-pi%E3%81%A7radiko%E3%81%AE%E5%86%8D%E7%94%9F%E9%8C%B2%E9%9F%B3)
- [ãƒ©ã‚¸ã‚³: FreeBSD ã§éŒ²éŸ³ã™ã‚‹ radiko.sh ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ](http://www.lifewithunix.jp/notes/2016/10/22/radiko-recording-script-for-freebsd-updated/)
- [ã‚‰ã˜ã‚‹ã‚‰ã˜ã‚‹ m3u8 ã‚’ ffmpeg ã§éŒ²éŸ³ã™ã‚‹ï¼ˆï¼˜æ”¾é€å±€ï¼‰2017/9 ä»¥é™å¯¾å¿œ](https://gist.github.com/riocampos/93739197ab7c765d16004cd4164dca73)
- [Some livecoding.tv streams only play audio even though there's video on the website](https://github.com/chrippa/livestreamer/issues/1180)
- [How to play Akamai adaptive HLS stream in fullscreen mode with auto start on boot](https://raspberrypi.stackexchange.com/questions/27688/how-to-play-akamai-adaptive-hls-stream-in-fullscreen-mode-with-auto-start-on-boo)
